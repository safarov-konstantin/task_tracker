# TB5 (Стек технолокий: DRF, JSON, API)

Необходимо реализовать серверное приложение для работы с базой данных. Требования к базе данных:
* БД реляционная (желательно Postgres)
* БД представляет собой трекер задач и содержит следующие таблицы:

1. таблица сотрудников (ФИО, должность, ...);

2. таблица задач (наименование, ссылка на родительскую задачу, если есть зависимость, исполнитель, срок, статус, ...).

Реализовать на Python REST API (желательно FastAPI) со следующими эндпоинтами:
- CRUD для сотрудников и задач
- "Занятые сотрудники": Запрашивает из БД список сотрудников и их задачи, отсортированный по количеству активных задач.
    
### "Важные задачи":
1. Запрашивает из БД задачи не взятые в работу, и от которых зависят другие задачи, взятые в работу.

2. реализует поиск по сотрудникам, которые могут взять такие задачи (наименее загруженный сотрудник или сотрудник выполняющий родительскую задачу если ему назначено максимум на 2 задачи больше, чем у наименее загруженного сотрудника).
    
Желательно реализовать валидацию данных.

**Стек технолокий: DRF, JSON, API** 


## Документация
**Содержание:**

- [Общее описание](#Общее_описание)
- [Описание_данных](#Описание_данных)
- [Описание эндпоинтов для Пользователей](#Описание_эндпоинтов_для_Пользователей)
- [Описание_эндпоинтов для Трекера задач](#Описание_эндпоинтов_для_Трекера_задач)
- [Примеры](#Примеры)
- [Запуск проекта](#Запуск_проекта)



### Общее описание
<a name="Общее_описание"></a>
Данные серверное приложение состоит из двух составляющийх:

* Сотрудники
* Трекер задач

**Все ответы и тело запросов формируется в JSON**

### Описание данных
<a name="Описание_данных"></a>
Пользователи содержат:
* Должность (Position):
    - 'id' - целое число, атоматически генирируется.
    - 'name'  - строка, 150 символов, обязательное для заполнения 

* Сотрудник (User)
    - 'id' - целое число, атоматически генирируется 
    - 'email' - строка, с валидацией для emai, обязательное для заполнения
    - 'first_name' - строка, 150 символов
    - 'last_name' - строка, 150 символов
    - 'phone' - строка, 35 символов без валидации 
    - 'position' - целое число, id должности 
    - 'tasks' - список, в данный список входят id задач 
    - 'password' - строка, с валидацие пароля, обязательное для заполнения

Трекер задач содержит:
* Статус (Status)
    - 'id' - целое число, атоматически генирируется.
    - 'name'  - строка, 150 символов, обязательное для заполнения 
* Задача (Task)
    - 'id' - целое число, атоматически генирируется.
    - 'name' - строка, 200 символов, обязательное для заполнения           
    - 'description' - строка, обязательное для заполнения
    - 'status' - целое число, id статуса
    - 'parent' - целое число id родительской задачи 
      
### Описание эндпоинтов для Пользователей
<a name="Описание_эндпоинтов_для_Пользователей"></a>
**таб 1. "Описакние для должностей"**
|Тип запроса|Эндпоинт|Описание|
|-|--------|---|
|GET|/users/positions/| Возвращает список дожностей|
|GET|/users/positions/id_position/|Возвращает должность по id (id_position)|
|POST|/users/positions/create/|Создание должности, возвращает созданную должность|
|PUT или PATCH |/users/positions/update/id_position/|Изменить должность по id (id_position))|
|DELETE|/users/positions/delete/id_position/|Удалить должность по id (id_position))|
> **Примечание:** Для формирования структур тела запроса для типов POST, PUT, PATCH \
> посмотрите раздел документации [Описание_данных](#Описание_данных)

**таб 2. "Описакние для сотрудников"**
|Тип запроса|Эндпоинт|Описание|
|-|--------|---|
|GET|/users/| Возвращает список дожностей|
|GET|/users/id_user/|Возвращает должность по id (id_user)|
|POST|/users/create/|Создание сотрудника, возвращает созданного сотрудника|
|PUT или PATCH |/users/update/id_user/|Изменить сотрудника по id (id_user))|
|DELETE|/users/delete/id_user/|Удалить должность по id (id_user))|
|GET|/users/employed/|Запрашивает из БД список сотрудников и их задачи, отсортированный по количеству активных задач|
|GET|/users/available/id_task/|реализует поиск по сотрудникам, которые могут взять задачу по id(id_task) (наименее загруженный сотрудник или сотрудник выполняющий родительскую задачу если ему назначено максимум на 2 задачи больше, чем у наименее загруженного сотрудника)|
> **Примечание:** Для формирования структур тела запроса для типов POST, PUT, PATCH \
> посмотрите раздел документации [Описание_данных](#Описание_данных)

### Описание эндпоинтов для Трекера задач
<a name="Описание_эндпоинтов_для_Трекера_задач"></a>
**таб 3. "Описакние для статусов"**
|Тип запроса|Эндпоинт|Описание|
|-|--------|---|
|GET|/status/| Возвращает список cстатусов|
|GET|/status/id_status/|Возвращает статус по id (id_status)|
|POST|/status/create/|Создание статуса, возвращает созданный статус|
|PUT или PATCH |/status/update/id_status/|Изменить статус по id (id_status))|
|DELETE|/status/delete/id_status/|Удалить статус по id (id_status))|
> **Примечание:** Для формирования структур тела запроса для типов POST, PUT, PATCH \
> посмотрите раздел документации [Описание_данных](#Описание_данных) 

**таб 4. "Описакние для задач"**
|Тип запроса|Эндпоинт|Описание|
|-|--------|---|
|GET|/| Возвращает список задач|
|GET|/id_task/|Возвращает задачу по id (id_task)|
|POST|/create/|Создание задачи, возвращает созданную задачу|
|PUT или PATCH |/update/id_task/|Изменить задачу по id (id_task))|
|DELETE|/delete/id_task/|Удалить задачу по id (id_task))|
|GET|/important/|Запрашивает из БД задачи не взятые в работу, и от которых зависят другие задачи, взятые в работу|
> **Примечание:** Для формирования структур тела запроса для типов POST, PUT, PATCH \
> посмотрите раздел документации [Описание_данных](#Описание_данных)

## Примеры
<a name="Примеры"></a>
Все примеры будут проводиться на http://localhost:8000/

### Создание должности

Запрос на эндпоинт /users/positions/create/ <br>
```
http://localhost:8000/users/positions/create/
```
Тип запроса: POST <br>
Body (для создания нужен "name" см. [Описание_данных](#Описание_данных)): <br>

```json
{
    "name": "Программист"
}
```
  
При успешном создании вернет структуру:

```json
{
    "id": 1
    "name": "Программист"
}
```
где id - генерируестя автоматически!

### Получить список задач

Запрос на эндпоинт / <br>
```
http://localhost:8000/
```
Тип запроса: GET <br> 
  
При успешном запросе вернет список структур задач:

```json
[
    {
        "id": 2,
        "name": "task parent test1",
        "description": "task parent test1",
        "status": null,
        "parent": null
    },
    {
        "id": 3,
        "name": "task child test1",
        "description": "task child test1",
        "status": null,
        "parent": 2
    },
    {
        "id": 4,
        "name": "task child test2",
        "description": "task child test2",
        "status": null,
        "parent": 2
    },
]
```
Структуру данных см. [Описание_данных](#Описание_данных)

## Запуск проекта
<a name="Запуск_проекта"></a>
* Установить зависимости из файла requirements.txt

* Создать файл .env по описанию из файла .env.sample

* Запустить приложение командой python3 manage.py runserver
